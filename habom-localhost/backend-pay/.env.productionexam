# ==============================================================================
# Backend-Pay Environment (.env.production)
# 운영 환경 설정 파일 - 결제 처리 서버
#
# 사용 방법:
# 1. 이 파일을 복사하여 .env.production 파일로 저장
#    cp .env.production.example .env.production
# 2. 아래 [필수 수정] 항목들을 실제 환경에 맞게 수정
#
# 설정 순서:
# 1. Toss Payments API 정보 입력 (운영키로 입력해야함)
# 2. DATABASE_URL 정보 입력
# 3. JWT_SECRET (backend-market과 동일한 secret를 사용해야함)
# 4. API_KEY 생성
# 5. CORS_ORIGIN = frontend-market URL
# 6. SWAGGER (white list 수정)
# 7. Webhook Configuration 정보
# 8. Email/SMTP Configuration 정보 입력
# 9. Payment Validation (결제 금액 검증)
# 10. Encryption 설정
# ==============================================================================

# ------------------------------------------------------------------------------
# Server
# ------------------------------------------------------------------------------
PORT=8080
NODE_ENV=production

# ------------------------------------------------------------------------------
# Toss Payments API
# [필수 수정] TossPayments에서 발급받은 API 키 입력
# 테스트 키: test_sk_/test_ck_ (테스트 환경용)
# 운영 키: live_sk_/live_ck_ (실제 결제용)
# https://developers.tosspayments.com 에서 발급
# ------------------------------------------------------------------------------
TOSS_SECRET_KEY=test_sk_U0VDUkVUX1RFU1RfQkFTRTY0XzAy
TOSS_CLIENT_KEY=test_ck_Q0xJRU5UX1RFU1RfQkFTRTY0XzAx
# 테스트 예시: test_sk_xxxxxxxxxxxxxxxxxxxxxxxx
# 운영 예시: live_sk_xxxxxxxxxxxxxxxxxxxxxxxx
TOSS_API_BASE=https://api.tosspayments.com

# ------------------------------------------------------------------------------
# Database (MySQL)
# [필수 수정] Docker .env 파일의 MySQL 설정과 일치해야 합니다
# DATABASE_URL 형식: mysql://user:pass@host:port/database?charset=utf8mb4
# ------------------------------------------------------------------------------
DATABASE_URL=mysql://marketuser:$CAf@McTY&9OczrcT5RInCYD@mysql-pay:3306/pay_db?charset=utf8mb4
DB_SYNCHRONIZE=true
DB_TIMEZONE=Z
DB_POOL_MAX=20
DB_POOL_MIN=5

# 개별 설정 (DATABASE_URL 없을 때 fallback) - 일반적으로 수정 불필요
DB_HOST=mysql-pay
DB_PORT=3306
DB_USERNAME=<YOUR_MYSQL_USER>
DB_PASSWORD=<YOUR_MYSQL_PASSWORD>
DB_DATABASE=pay_db
DB_SSL_REJECT_UNAUTHORIZED=false

# ------------------------------------------------------------------------------
# JWT Authentication
# [필수 수정] backend-market과 동일한 JWT_SECRET 사용 (토큰 공유)
# 생성: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
# ------------------------------------------------------------------------------
JWT_SECRET=5875383480bdb38d8f3ce9df9c64dc0139499da967f5e2f2491ff5141577adab60d5d1f55f6f77f246d71bc7bcd8c65619cd261530760d6e1fab12f74b664a68
JWT_EXPIRES_IN=1h

# [필수 수정] API 인증용 키 생성
# 생성: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
API_KEY=161652421a9d0b991b1868d74b96f50cd71e36c1b81f8aac0c80fdd8760073b9

# ------------------------------------------------------------------------------
# CORS
# [필수 수정] Frontend 도메인 URL
# ------------------------------------------------------------------------------
CORS_ORIGIN=http://localhost:12055
# 예시: https://yourdomain.com

# ------------------------------------------------------------------------------
# Swagger
# [필수 수정] Swagger UI 접근 제어
# 운영 환경에서는 비활성화 또는 강력한 비밀번호 사용 권장
# ------------------------------------------------------------------------------

SWAGGER_USER=admin
SWAGGER_PASSWORD=4090b930926564eef809bcf9f6bb1027
SWAGGER_IP_WHITELIST=127.0.0.1,::1
# [필수 수정] 허용할 IP 주소 목록 (쉼표로 구분)


# ------------------------------------------------------------------------------
# Webhook Configuration
# [필수 수정] TossPayments 웹훅 설정
# WEBHOOK_SIGNATURE_SECRET: TossPayments 대시보드에서 제공하는 Secret 또는 직접 생성
# 생성: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# ------------------------------------------------------------------------------
WEBHOOK_SIGNATURE_SECRET=V0VCSE9PS19TSUdOQVRVUkVfQkFTRTY0XzAz
# TossPayments 웹훅 IP 화이트리스트 (변경하지 마세요 - TossPayments 공식 IP)
WEBHOOK_IP_WHITELIST=13.124.18.147,13.124.108.35,3.36.173.151,3.38.81.32,115.92.221.121,115.92.221.122,115.92.221.123,115.92.221.125,115.92.221.126,115.92.221.127
WEBHOOK_IP_WHITELIST_ENABLED=true
WEBHOOK_MAX_RETRIES=3
WEBHOOK_BASE_DELAY_MS=60000
WEBHOOK_MAX_DELAY_MS=3600000

# ------------------------------------------------------------------------------
# Rate Limiting (운영 환경 - 엄격한 설정)
# [선택 수정] 각 레벨별 분당 요청 제한 (단위: 요청 수)
# ------------------------------------------------------------------------------
RATE_LIMIT_TTL=60000
RATE_LIMIT_DEFAULT=50
RATE_LIMIT_STRICT=5
RATE_LIMIT_VERY_STRICT=3
RATE_LIMIT_RELAXED=200
RATE_LIMIT_ORDER=30

# ------------------------------------------------------------------------------
# Logging
# [선택 수정] 로그 레벨: error, warn, info, http, verbose, debug, silly
# ------------------------------------------------------------------------------
LOG_LEVEL=warn
LOG_RETENTION_DAYS=30
ERROR_LOG_RETENTION_DAYS=90
AUDIT_LOG_RETENTION_DAYS=365

# ------------------------------------------------------------------------------
# Email/SMTP Configuration
# [필수 수정] 이메일 발송 설정
# ------------------------------------------------------------------------------
SMTP_HOST=<YOUR_SMTP_HOST>
SMTP_PORT=465
SMTP_SECURE=true
SMTP_USER=<YOUR_SMTP_USER>
SMTP_PASSWORD=<YOUR_SMTP_PASSWORD>
SMTP_TLS_REJECT_UNAUTHORIZED=true
EMAIL_FROM=<YOUR_EMAIL_FROM>
EMAIL_FROM_NAME=<YOUR_SERVICE_NAME>
# 예시:
# SMTP_HOST=smtp.gmail.com
# SMTP_USER=your-email@gmail.com
# EMAIL_FROM=noreply@yourdomain.com
# EMAIL_FROM_NAME=Your Service Name

# ------------------------------------------------------------------------------
# Payment Validation (결제 금액 검증)
# [선택 수정] 서비스에 맞게 조정
# ------------------------------------------------------------------------------
PAYMENT_MIN_AMOUNT=100
PAYMENT_MAX_AMOUNT=10000000
PAYMENT_DAILY_LIMIT=50000000
PAYMENT_DAILY_TRANSACTION_LIMIT=100
PAYMENT_ANOMALY_THRESHOLD=3
PAYMENT_AVERAGE_AMOUNT=100000

# ------------------------------------------------------------------------------
# Encryption (민감 데이터 암호화)
# [필수 수정] 암호화 마스터 키 생성
# ENCRYPTION_KEY_PROVIDER: local, aws_kms, azure_key_vault
# ENCRYPTION_MASTER_KEY 생성: node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
# ------------------------------------------------------------------------------
ENCRYPTION_KEY_PROVIDER=local
ENCRYPTION_MASTER_KEY=jXSw33182i8O5+lBOZAtSZawsC5nvh/19DBxegSWhxU=
ENCRYPTION_KEY_VERSION=1
ENCRYPTION_PREVIOUS_KEYS=

# ------------------------------------------------------------------------------
# Elasticsearch (로그 중앙화, 선택사항)
# [선택] 설정하지 않으면 ES 연동 비활성화
# ------------------------------------------------------------------------------
ELASTICSEARCH_URL=
ELASTICSEARCH_USERNAME=
ELASTICSEARCH_PASSWORD=
ELASTICSEARCH_INDEX_PREFIX=tosspayments-logs
ELASTICSEARCH_TLS_REJECT_UNAUTHORIZED=true

# ------------------------------------------------------------------------------
# Sentry APM (선택사항)
# [선택] 에러 모니터링 서비스
# ------------------------------------------------------------------------------
SENTRY_DSN=
